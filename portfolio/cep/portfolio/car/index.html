
<!DOCTYPE html><html class=''>
<head><meta charset='UTF-8'><meta name="robots" content="noindex">
<title>& I just drive</title>
<style>
body {
  overflow:hidden;
  margin:0;
  } canvas {
  display: block;
}
.controls {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 2em;
  z-index: 10;
  font-size: 10px;
  color: #FFF;
  opacity: 0.6;
}
</style></head><body>
<div class="controls">Drive with arrow keys or WASD. Toggle headlights with L</div>
<script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/r79/three.min.js'></script><script src='https://cdnjs.cloudflare.com/ajax/libs/gsap/1.19.0/TweenMax.min.js'></script>
<script>;(function(){
  
  // bracket [≠] square [⠝] 
  var svgIcon = '<svg class="shaw__icon" width="222" height="284" viewBox="0 0 2223 2846"><path fill="#f4d198" d="M1040 436c46-.8 71.4 17.4 103 31l82 35 441 189c-3 6.2-3.7 9-2 16 28.7 21.2 64 26.6 102 41 32 12.2 62.6 27.5 89 46 70 49.6 122 125.5 156 211 16.7 42.4 23 95.4 40 136 21.3 52.2 85.3 136.6 72 214-9 50.5-31.4 75-57 107-19 23.4-52 45.2-43 95 14.7 82.3 57.8 139 89 205 10.8 23.4 22 46.7 32.8 70l10 32c17.8 28 85.5 81.5 64 130-15 34.3-48.4 58.2-84 72-17 4.4-34 8.8-51 13 5 15.5 9 29.5 16 42-5.6 6.8-11.3 13.4-17 20 1.4 58 36.5 119.5 4 164-14 19.4-35 26.6-54 41 9.7 12.6 21.5 23.3 28 39 30 72.4-52.2 154.4-82 196-17.7 25-36.7 64.3-64 79-52.3-6.2-104.6-12.6-157-19-130.8-26-259.5-41.8-381-76-82.6-23-166-43.7-243-74l-143-59c-.2-50-.5-100-1-150h-1c-23.5 1.4-47.2 2.8-71 4l-15 15c-13.7 10.2-32 17.4-52 21-90.8 17.2-202.2-74.8-249.8-112l-42-38c-11.4-1.6-22.7-3.2-34-5-33.6-7.2-99.3-17.8-115-41l-67-167-142-339 166-20c1.4-27.2 26.6-95.5 51-97l181 49 2-1c-.7-51.7 2-106.3 10-154 8.6-51.6 8-103.5 17-152l18-124c29.5-135.3 55.3-266.4 104-381 41.2-97.2 85.7-194 164-254 22.4-17.2 48.8-32.8 79-42l47-8z"/><path fill="#bf3d27" d="M1008 59v-8c14.8 4.4 23.6 20.4 35 29l65 43c8.4 6.3 26.4 24.8 40 21 9.7-5 8.2-22.2 8-34 15 7.2 32.2 21.3 49 24v-5c-4.4-15.4-4.7-33-7-51h6c88.8 27.2 209.3 5.2 297 22l52-2c32.2 7.3 66.3 35.3 97 47l52 17c3.5 5.7 7.2 11.3 11 17 8.2 6.3 16.5 12.7 25 19 58.6 30.8 113.8 60 168 93l24 10c10.6 7.4 11 22.2 20 31 13.2 9.3 26.5 18.7 40 28 31.5 25.4 72.8 84 89 124 14 35.8 12.7 100 3 139-23.3 92-85 195.2-150 244-3.5-3.3-6.8-6.6-10-10l-51-46-213 57-196 85c-41.2 18-84.3 36-122 58-26 15-49.5 34-83 41-54 11.2-111-6.6-161-7 8.6 61.2 25 132 52 179 8 14.2 41.8 81.8 39 101-12.7 85.2-70.4 125.8-122 172l7 137 7 101c12.5 77.8 10 156.3 24 229 9 48 13 94 25 137l8 34c8.6 16 90.4 62.3 111 75 79.6 49.7 164.7 96.8 254 136 38.3 17 84 48.6 126 58 18.4-23 38-43 54-70 6.2-14.6 12.5-29.2 19-44 6.3-10.5 67.2-41 82-50 61.3-37.3 124.7-70.7 196-99 34.2-13.5 75.3-29.6 121-23 4.5 10.4 9.2 20.8 14 31 10.6 34.2.8 70.2-12 94-31.2 1-63 14.8-89 23-82.7 26.3-167.3 58-214 120-23.7 31.4-44 88.3-13 128 18.2 23.8 53.3 24 83 11 21.6-9.4 40-30.8 59-39 18.4-7.8 80.2-5.5 99 0-2.6 28.8-3.4 61.8-3 94v47c-14 83.2-40 137-95 177-94.4 68.6-214.8 41.3-315 2-60.8-21.5-121.4-43.2-182-65-120.6-58-243.3-122.3-355-190-72.2-43.5-139.8-77-182-150-17.7-30.3-20-87-12-132l28-184 6-76c5.3-33.3 2.7-117-9-139l-62-67c-57-57-198.2-164.5-324-138-42.3 9-87.2 26.4-109 56-32 43.3-40.3 141.8-16 201 27.5 67.4 69.7 136 112 191l80 84 4 40c11.4 71.7-24.4 176.2-59 205-10.4-11.6-20.7-23.2-31-35-22.4-28-47.7-53.4-70-82-60.6-77-115.6-155-167-243-18-31-29.4-66-44-100l-83-196C88.7 1670 27.3 1539.8 0 1406v-138c0-155.8 32.6-292.3 91-391 16.3-27.6 37-57 62-76l29-17 52-44 22-17 62-96 14-46 35-86c29.3-66.6 70.2-123.8 113-177 23.6-29.4 57-46.7 87-70C627.8 201 717.3 93.4 730 0h4c30 13 74.3 15.3 109 21h27c19.6 5.2 33.4 22.5 56 28l1-13h8l-1-8 26 11 3-4c10.6 9.8 27 22.4 45 24zm917 68h2-2zm2 1h2-2zm58 47c1.5 1.7 3.2 3.3 5 5l-3-2c-3.2-2-1.2-.3-2-3z"/></svg>';
  
  document.head.insertAdjacentHTML('beforeend','<style>.shaw { display: block; position: absolute; position: fixed; z-index: 9999; bottom: 5px; right: 5px; font-size: 10px; color: #c03b27; text-decoration: none; padding: 10px; border-radius: 50%; opacity: 0.4; transform-origin: 100% 100%; transition: all 300ms ease-in-out; } .shaw > * { transition: inherit; } .shaw:hover { opacity: 1; background: rgba(255,255,255,0.9); } .shaw__icon, .shaw__title { display: inline-block; vertical-align: middle; } .shaw__icon { width: 24px; height: 24px; position: relative; z-index: 1; } .shaw__title {  white-space: nowrap; opacity: 0; padding-right: 10px; transform: translateX(100%); } .shaw:hover .shaw__title { transform: scale(1); opacity: 1; } .shaw:hover .shaw__icon { transform: scale(1.4); } </style>'); // .shaw__title { position: absolute; right: 100%; top: 50%; margin-top: -0.5em;width: fit-content; position: absolute; right: 100%; margin-right: 10px; }
  

  //document.body.insertAdjacentHTML('beforeend','<a href="http://codepen.io/shshaw" target="_blank" class="shaw">'+svgIcon+'</a>');
  
})();

</script>
<script>'use strict';

console.clear();

/*////////////////////////////////////////*/

var scene, camera, renderer, orbit, light;
var renderCalls = [];

scene = new THREE.Scene();
scene.fog = new THREE.Fog(0x242426, 20, 600);

camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 10, 600);
camera.position.z = 90;
//camera.position.y = 50;
//camera.position.x = 30;

renderer = new THREE.WebGLRenderer({ antialias: true });
renderer.setPixelRatio(window.devicePixelRatio);
renderer.setSize(window.innerWidth, window.innerHeight);
renderer.setClearColor(0x242426);
renderer.toneMapping = THREE.LinearToneMapping;

renderer.shadowMap.enabled = true;
renderer.shadowMap.type = THREE.PCFSoftShadowMap;

window.addEventListener('resize', function () {
  camera.aspect = window.innerWidth / window.innerHeight;
  camera.updateProjectionMatrix();
  renderer.setSize(window.innerWidth, window.innerHeight);
}, false);

document.body.appendChild(renderer.domElement);

/*////////////////////////////////////////*/

// var ambientLight = new THREE.AmbientLight(0x222222);
// scene.add(ambientLight);

var hemiLight = new THREE.HemisphereLight(0xEBF7FD, 0xEBF7FD, 0.2);
//hemiLight.color.setRGB(0.75,0.8,0.95);
hemiLight.position.set(0, 20, 20);
scene.add(hemiLight);

/*////////////////////////////////////////*/

function noiseMap() {
  var size = arguments.length <= 0 || arguments[0] === undefined ? 256 : arguments[0];
  var intensity = arguments.length <= 1 || arguments[1] === undefined ? 60 : arguments[1];
  var repeat = arguments.length <= 2 || arguments[2] === undefined ? 0 : arguments[2];

  var canvas = document.createElement('canvas'),
      ctx = canvas.getContext('2d'),
      width = canvas.width = size,
      height = canvas.height = size;

  var imageData = ctx.getImageData(0, 0, width, height),
      pixels = imageData.data,
      n = pixels.length,
      i = 0;

  while (i < n) {
    pixels[i++] = pixels[i++] = pixels[i++] = Math.sin(i * i * i + i / n * Math.PI) * intensity;
    pixels[i++] = 255;
  }
  ctx.putImageData(imageData, 0, 0);

  var texture = new THREE.Texture(canvas);
  if (repeat) {
    texture.wrapS = texture.wrapT = THREE.RepeatWrapping;
    texture.repeat.set(repeat, repeat);
  }
  texture.needsUpdate = true;

  return texture;
}

/*////////////////////////////////////////*/

var carGeometry = new THREE.BoxGeometry(20, 10, 3);
var carMaterial = new THREE.MeshPhongMaterial({
  color: 0xB74242,
  //specular: 0x009900,
  //bumpMap: noiseMap(128, 20, 5),
  shininess: 100,
  emissive: 0xFF0000,
  emissiveIntensity: 0.6
});

var carTopGeometry = new THREE.BoxGeometry(12, 8, 5);
var carTopMaterial = new THREE.MeshPhongMaterial({
  color: 0xB74242,
  //specular: 0x009900,
  //bumpMap: noiseMap(128, 20, 5),
  shininess: 100,
  emissive: 0x990000,
  emissiveIntensity: 0.7
});

var wheelGeometry = new THREE.CylinderGeometry(3, 3, 1, 6);
var wheelMaterial = new THREE.MeshBasicMaterial({ color: 0x000000 });

function Car(color) {
  var _this = this;

  THREE.Object3D.apply(this, arguments);

  var carBody = new THREE.Mesh(carGeometry, carMaterial);
  carBody.castShadow = true;
  carBody.receiveShadow = true;
  this.add(carBody);

  var carTop = new THREE.Mesh(carTopGeometry, carTopMaterial);
  carTop.position.x -= 2;
  carTop.position.z += 3.5;
  carTop.castShadow = true;
  carTop.receiveShadow = true;

  this.add(carTop);

  this.castShadow = true;
  this.receiveShadow = true;

  /*////////////////////////////////////////*/

  var light = new THREE.PointLight(0xFFFFFF, 1, 0);
  light.position.z = 25;
  light.position.x = 5;

  light.castShadow = true;
  light.shadow.mapSize.width = 512;
  light.shadow.mapSize.height = 512;
  light.shadow.camera.near = 0.1;
  light.shadow.camera.far = 50;
  light.shadow.bias = 0.1;
  light.shadow.radius = 5;

  light.power = 3;

  this.add(light);

  /*////////////////////////////////////////*/

  this.wheels = Array(4).fill(null);
  this.wheels = this.wheels.map(function (wheel, i) {
    wheel = new THREE.Mesh(wheelGeometry, wheelMaterial);
    wheel.position.y = i < 2 ? 6 : -6;
    wheel.position.x = i % 2 ? 6 : -6;
    wheel.position.z = -3;
    _this.add(wheel);
    return wheel;
  });

  /*////////////////////////////////////////*/

  this.lights = Array(2).fill(null);
  this.lights = this.lights.map(function (light, i) {

    light = new THREE.SpotLight(0xffffff);
    light.position.x = 11;
    light.position.y = i < 1 ? -3 : 3; //;
    light.position.z = -3;
    light.angle = Math.PI / 3.5;

    light.castShadow = true;

    light.shadow.mapSize.width = 512;
    light.shadow.mapSize.height = 512;

    light.shadow.camera.near = 1;
    light.shadow.camera.far = 400;
    light.shadow.camera.fov = 40;

    light.target.position.y = i < 1 ? -0.5 : 0.5;
    light.target.position.x = 35; // = Math.PI/2;

    _this.add(light.target);
    _this.add(light);

    return light;
  });

  //this.rotation.x = Math.PI / 2;
}

Car.prototype = Object.assign(THREE.Object3D.prototype, {
  constructor: Car,

  maxspeed: 3,
  speed: 0,
  angle: 0,
  steering: 0,
  lightsOn: true,

  // Driving controls adapted from http://codepen.io/Beclamide/pen/bNyxVz?editors=0010
  update: function update() {
    var _this2 = this;

    var prev = {
      x: this.position.x,
      y: this.position.y,
      rot: this.rotation.z
    };

    var steerPower = 0.0006; // / (this.speed + 1);

    // steering
    if (keys[39] || keys[68]) {
      this.steering += this.steering > -.01 ? steerPower : 0;
      // left
    } else if (keys[37] || keys[65]) {
        this.steering -= this.steering < .01 ? steerPower : 0;
      } else {
        this.steering *= 0.92;
      }

    // gas
    if (keys[38] || keys[87]) {
      this.speed += this.speed < this.maxspeed ? 0.04 : 0;
    } else if (keys[40] || keys[83]) {
      // reverse
      this.speed -= this.speed > -this.maxspeed / 2 ? 0.04 : 0;
    } else {
      this.speed *= 0.96;
    }

    this.speed *= 1 - Math.abs(this.steering / 2);

    this.angle += this.steering * this.speed;

    if (this.wheels) {
      this.wheels.forEach(function (wheel, i) {
        wheel.rotation.y += 0.1 * _this2.speed;
        //wheel.rotation.x = Math.sin(this.angle);// * 0.2;
      });
    }

    var xdir = this.speed * Math.cos(this.angle);
    var ydir = this.speed * Math.sin(this.angle);

    this.position.x += xdir;
    this.position.y += -ydir;
    this.rotation.z = -this.angle;

    if (this.lights) {
      this.lights.forEach(function (light, i) {

        light.rotation.z = _this2.angle;
        light.target.position.clone(_this2.position);
        light.target.position.x += 10;
        light.target.position.y += i < 1 ? -0.5 : 0.5;
        light.target.updateMatrixWorld();
      });

      if (keys[76]) {

        keys[76] = false;
        this.lightsOn = !this.lightsOn;

        TweenMax.staggerTo(this.lights, 0.3, {
          intensity: this.lightsOn ? 1 : 0,
          ease: RoughEase.ease
        }, 0.02);
      }
    }

    this.position.x = this.position.x > 990 || this.position.x < -990 ? prev.x : this.position.x;
    this.position.y = this.position.y > 990 || this.position.y < -990 ? prev.y : this.position.y;

    camera.position.x += (this.position.x - camera.position.x) * 0.1; //0.02; // (camera.position.x - this.position.x)/50;
    camera.position.y = this.position.y - 40 - this.speed * 10; //(( this.position.y -camera.position.y ) * 0.01 ) +; //0.02; //(camera.position.y - thiposition.y)/50;

    //camera.position.z = ( 40 + (Math.cos(this.speed)+1/2) * 40 );

    camera.lookAt(new THREE.Vector3(this.position.x, // + (xdir * 4),
    this.position.y, // - (ydir * 4),
    0 //Math.sin( (this.speed / this.maxspeed) * Math.PI*2 )+1/2 * 80)
    ));
  }
});

var keys = [];

document.body.addEventListener("keydown", function (e) {
  keys[e.keyCode] = true;
  e.preventDefault();
});

document.body.addEventListener("keyup", function (e) {
  keys[e.keyCode] = false;
  e.preventDefault();
});

var car = new Car();
scene.add(car);

renderCalls.push(car.update.bind(car));

/*////////////////////////////////////////*/

var noise = noiseMap(256, 20, 30);
function snowyGround() {

  var geometry = new THREE.PlaneGeometry(2000, 2000, 40, 45);
  for (var i = 0; i < geometry.vertices.length; i++) {
    geometry.vertices[i].x += (Math.cos(i * i) + 1 / 2) * 2;
    geometry.vertices[i].y += (Math.cos(i) + 1 / 2) * 2;
    geometry.vertices[i].z = (Math.sin(i * i * i) + 1 / 2) * -4;
  }
  geometry.verticesNeedUpdate = true;
  geometry.normalsNeedUpdate = true;
  geometry.computeFaceNormals();

  var material = new THREE.MeshPhongMaterial({
    color: 0xFFFFFF,
    shininess: 80,
    //metalness: 1,
    //specularMap: noiseMap(512,255),
    bumpMap: noise,
    bumpScale: 0.15,
    //emissive: 0xEBF7FD,
    //emissiveIntensity: 0.05,
    shading: THREE.SmoothShading
  });

  var plane = new THREE.Mesh(geometry, material);
  //plane.rotation.x = Math.PI / -2;
  plane.receiveShadow = true;
  plane.position.z = -5;

  return plane;
}
scene.add(snowyGround());

/*////////////////////////////////////////*/

var count = 3;
function render() {

  requestAnimationFrame(render);
  count += 0.03;

  renderCalls.forEach(function (callback) {
    callback();
  });

  renderer.toneMappingExposure = Math.pow(0.91, 5.0);
  renderer.render(scene, camera);
};

render();

/*

// http://www.somethinghitme.com/2013/11/13/snippets-i-always-forget-movement/
var canvas = document.createElement("canvas"),
    ctx = canvas.getContext("2d"),
    width = 500,
    height = 500,
    keys = [];

document.body.appendChild(canvas);

canvas.width = width;
canvas.height = height;

document.body.addEventListener("keydown", function(e) {
    keys[e.keyCode] = true;
    e.preventDefault();
});

document.body.addEventListener("keyup", function(e) {
    keys[e.keyCode] = false;
    e.preventDefault();
});


var Ship = function (x, y, radius, color) {
    this.x = x || 0;
    this.y = y || 0;
    this.radius = radius || 10;

    this.isThrusting = false;
    this.thrust = 0.1;
    this.turnSpeed = 0.001;
    this.angle = 0;

    this.color = color || "rgb(255,0,0)";

    this.pointLength = 20;
    this.px = 0;
    this.py = 0;

    this.velX = 0;
    this.velY = 0;
}

Ship.prototype.turn = function(dir){
    this.angle += this.turnSpeed * dir;
};

const rad2deg = Math.PI * 180;
Ship.prototype.update = function () {
    // Get the direction we are facing
    var radians = this.angle/Math.PI * 180;

    //lol wut
    if(this.isThrusting){
      this.velX += Math.cos(radians) * this.thrust;
      this.velY += Math.sin(radians) * this.thrust;
    }

    // bounds check    
    if(this.x < this.radius){
        this.x = canvas.width;   
    }
    if(this.x > canvas.width){
        this.x = this.radius;   
    }
    if(this.y < this.radius){
        this.y = canvas.height;   
    }
    if(this.y > canvas.height){
        this.y = this.radius;   
    }

    // calc the point out in front of the ship
    this.px = this.x - this.pointLength * Math.cos(radians);
    this.py = this.y - this.pointLength * Math.sin(radians);

    // apply friction
    this.velX *= 0.985;
    this.velY *= 0.985;

    // apply velocities    
    this.x -= this.velX;
    this.y -= this.velY;
};

Ship.prototype.render = function () {
    ctx.fillStyle = this.color;
    ctx.beginPath();
    ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
    ctx.closePath();
    ctx.fill();

    ctx.strokeStyle = "rgb(0,0,255)";
    ctx.beginPath();
    ctx.moveTo(this.x, this.y);
    ctx.lineTo(this.px, this.py);
    ctx.closePath();
    ctx.stroke();
};

var ship = new Ship(width/2, height/2, 10);

function render() {

    // check keys
    // up arrow or space
    ship.isThrusting = (keys[38] || keys[32]);

    if (keys[39]) {
        // right arrow
        ship.turn(1);
    }
    if (keys[37]) {
        // left arrow
       ship.turn(-1);
    }


    ctx.clearRect(0, 0, width, height);
    ship.update();
    ship.render();
    requestAnimationFrame(render);
}

render();

/**/
//# sourceURL=pen.js
</script>
</body></html>